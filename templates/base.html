<!DOCTYPE html>
<html>
  <head>
    <title>Flask Template Example</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style type="text/css">
      .container {
        max-width: 900px;
        height: 900px;
        background: lightblue;
        text-align: center;
        margin-top: 25px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <canvas id="world"
              width="850"
              height="850"
              style="
                border:1px solid #000000;
                margin-top: 25px;
              ">
      </canvas>
    </div>
    <script>
        let canvas = document.getElementById("world"),
            ctx = canvas.getContext('2d'),
            img = new Image();
        img.src = "../static/entity.svg";
        let scale = 32;
        let i_w = 512/scale,
            i_h = 512/scale;
        let boids = Array(50);
        for(let i = 0; i < boids.length; i++){
           boids[i] = {
               'x': Math.random() * 400,
               'y': Math.random() * 400,
               'speed': Math.abs(Math.random() * 3),
           };
           boids[i]['angle'] = Math.atan2(boids[i]['y'], boids[i]['x']);
        }
        animate = function(){
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            for(let i = 0; i < boids.length; i++){
                let x = boids[i]['x'],
                    y = boids[i]['y'],
                    speed = boids[i]['speed'],
                    angle = boids[i]['angle'];
                angle = 180 / Math.PI * (Math.random() * 360);
                x = x + speed*Math.cos(angle * 180 / Math.PI); //+ (Math.round(Math.random() * 100) - 200) / 100;
                y = y + speed*Math.sin(angle * 180 / Math.PI); //+ (Math.round(Math.random() * 100) - 200) / 100;
                if (x > 850 + i_w){
                    x = x - 850 - i_w;
                } else if (x < 0 - i_w){
                    x = x + 850 + i_w;
                }
                if (y > 850 + i_h){
                    y = y - 850 - i_h;
                } else if (y < 0 - i_h){
                    y = y + 850 + i_h;
                }
                angle = Math.atan2(y, x);
                boids[i]['x'] = x;
                boids[i]['y'] = y;
                boids[i]['angle'] = angle;
                boids[i]['speed'] = Math.abs(Math.random() * 3);
                ctx.save();
                ctx.translate(x, y);
                ctx.translate(i_w, i_h);
                ctx.rotate(angle);
                ctx.drawImage(img, 0, 0, i_w, i_h);
                ctx.rotate(-angle);
                ctx.translate(-x, -y);
                ctx.translate(-i_w, -i_h);
                ctx.restore();
            }
            requestAnimationFrame(animate);
        };
        run = function(){
            window.requestAnimationFrame(animate);
        };
        let fps = 1000/10; // 120 fps

        loop = function() {
            setTimeout(run, fps);
        };
        img.onload = loop;

    </script>
  </body>
</html>